{
  "variables": {
    "ssh_user": "cdd",
    "ssh_pass": "cdd",
    "base_vm_name": "cdd-base-vm",
    "bridge_interface": "en1: Wi-Fi (AirPort)",
    "locale": "en_US",
    "keyboard_layout": "USA"
  },
  "builders": [
    {
      "type": "virtualbox-iso",
      "vm_name": "{{user `base_vm_name`}}",
      "output_directory": "output-{{user `base_vm_name`}}",
      "guest_os_type": "Ubuntu",
      "iso_url": "http://releases.ubuntu.com/precise/ubuntu-12.04.5-server-i386.iso",
      "http_directory": "scripts/base",
      "iso_checksum": "1214cd22448338b60bb24f583dd8741a",
      "iso_checksum_type": "md5",
      "guest_additions_mode": "disable",
      "ssh_username": "{{user `ssh_user`}}",
      "ssh_password": "{{user `ssh_pass`}}",
      "ssh_wait_timeout": "20m",
      "shutdown_command": "echo '{{user `ssh_pass`}}' | sudo -S shutdown -P now",
      "disk_size": 8000,
      "headless": true,
      "boot_wait": "5s",
      "boot_command": [
        "<esc><esc><enter><wait>",
        "/install/vmlinuz noapic ",
        "preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg ",
        "debian-installer={{user `locale`}} auto locale={{user `locale`}} kbd-chooser/method=us ",
        "hostname={{user `base_vm_name`}} ",
        "fb=false debconf/frontend=noninteractive ",
        "keyboard-configuration/modelcode=SKIP keyboard-configuration/layout={{user `keyboard_layout`}} ",
        "keyboard-configuration/variant={{user `keyboard_layout`}} console-setup/ask_detect=false ",
        "initrd=/install/initrd.gz -- <enter>"
      ],
      "vboxmanage": [
        ["modifyvm", "{{.Name}}", "--memory", "512"],
        ["modifyvm", "{{.Name}}", "--cpus", "1"],
        ["modifyvm", "{{.Name}}", "--hwvirtex", "off"]
      ],
      "vboxmanage_post": [
        ["modifyvm", "{{.Name}}", "--nic1", "bridged", "--bridgeadapter1", "{{user `bridge_interface`}}"]
      ]
    }
  ],
  "provisioners": [
    {
        "type": "shell",
        "execute_command": "echo '{{user `ssh_pass`}}' | {{ .Vars }} sudo -S -E '{{ .Path }}'",
        "script": "scripts/base/configure-networking.sh"
    },
    {
        "type": "shell",
        "execute_command": "echo '{{user `ssh_pass`}}' | {{ .Vars }} sudo -S -E '{{ .Path }}'",
        "script": "scripts/base/upgrade-packages.sh"
    }
  ]
}
